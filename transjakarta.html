<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Combined Transjakarta Maps — Switcher</title>

  <!-- bootstrap for quick UI -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    html,body { height:100%; margin:0; }
    .topbar {
      position: fixed;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      background: rgba(255,255,255,0.95);
      padding: 8px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      display:flex;
      gap:8px;
      align-items:center;
    }

    .map-wrap {
      position: absolute;
      top:0; left:0; right:0; bottom:0;
      padding-top:56px; /* safety for topbar (so map content not overlapped) */
    }

    /* each iframe fills the available area */
    iframe.map-frame {
      width:100%;
      height:100%;
      border:0;
      display: none;
    }

    /* visible iframe */
    iframe.map-frame.active { display:block; }

    .btn-compact { padding: .35rem .6rem; font-size: .9rem; }

    @media (max-width:700px) {
      .topbar { left: 8px; transform: none; right: 8px; }
      .map-wrap { padding-top:80px; }
    }
  </style>
</head>
<body>

  <div class="topbar" role="toolbar" aria-label="Map switcher">
    <div class="btn-group" role="group" aria-label="Map buttons">
      <button class="btn btn-outline-primary btn-compact" data-map="route">Route speed</button>
      <button class="btn btn-outline-primary btn-compact" data-map="centrality">Enhanced centrality</button>
      <button class="btn btn-outline-primary btn-compact" data-map="bivariate">Bivariate gap</button>
      <button class="btn btn-outline-primary btn-compact" data-map="communities">Communities</button>
      <button class="btn btn-outline-primary btn-compact" data-map="density">Stop density</button>
    </div>

    <div class="ms-2 d-flex align-items-center">
      <label for="mapSelect" class="form-label me-2 mb-0">or select</label>
      <select id="mapSelect" class="form-select form-select-sm">
        <option value="route">Route speed</option>
        <option value="centrality">Enhanced centrality</option>
        <option value="bivariate">Bivariate gap</option>
        <option value="communities">Communities</option>
        <option value="density">Stop density</option>
      </select>
    </div>

    <div class="ms-3">
      <button id="fitAll" class="btn btn-sm btn-outline-secondary">Reload current map</button>
    </div>
  </div>

  <div class="map-wrap">
    <!-- iframes assume the files are in same folder as this index.html -->
    <iframe id="frame-route" class="map-frame" title="Route speed"
            src="transjakarta_route_speed_map.html"></iframe>

    <iframe id="frame-centrality" class="map-frame" title="Enhanced centrality"
            src="transjakarta_enhanced_centrality_map.html"></iframe>

    <iframe id="frame-bivariate" class="map-frame" title="Bivariate gap"
            src="transjakarta_bivariate_gap_map_v2.html"></iframe>

    <iframe id="frame-communities" class="map-frame" title="Communities"
            src="transjakarta_communities_map.html"></iframe>

    <iframe id="frame-density" class="map-frame" title="Stop density"
            src="transjakarta_stop_density_map.html"></iframe>
  </div>

  <script>
    // Map id -> iframe id mapping
    const mapToFrame = {
      'route': 'frame-route',
      'centrality': 'frame-centrality',
      'bivariate': 'frame-bivariate',
      'communities': 'frame-communities',
      'density': 'frame-density'
    };

    // initial visible map
    let current = 'route';

    function showMap(name) {
      // hide others and show chosen one
      Object.keys(mapToFrame).forEach(k => {
        const el = document.getElementById(mapToFrame[k]);
        if (!el) return;
        if (k === name) {
          el.classList.add('active');
        } else {
          el.classList.remove('active');
        }
      });
      // update select and buttons active state
      document.getElementById('mapSelect').value = name;
      document.querySelectorAll('.btn-group button').forEach(b => {
        b.classList.toggle('active', b.dataset.map === name);
      });
      current = name;
    }

    // wire up button clicks
    document.querySelectorAll('.btn-group button').forEach(btn => {
      btn.addEventListener('click', () => showMap(btn.dataset.map));
    });

    // select change
    document.getElementById('mapSelect').addEventListener('change', function(){
      showMap(this.value);
    });

    // "Reload current map" — reloads the iframe (useful if overlays / legends mis-render)
    document.getElementById('fitAll').addEventListener('click', () => {
      const frame = document.getElementById(mapToFrame[current]);
      if (frame) {
        // quick reload
        frame.contentWindow.location.reload();
      }
    });

    // keyboard shortcuts: 1..5 to switch maps
    window.addEventListener('keydown', (e) => {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.metaKey || e.ctrlKey) return;
      if (e.key >= '1' && e.key <= '5') {
        const order = ['route','centrality','bivariate','communities','density'];
        showMap(order[Number(e.key)-1]);
      }
    });

    // show initial map once DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      showMap(current);

      // a tiny usability improvement: when switching quickly between maps, some folium/leaflet maps
      // in iframes may need a small trigger to invalidate size. We try to postMessage a resize event
      // to the iframe where possible (most mappings will ignore; it's harmless).
      function triggerMapResize(frame) {
        try {
          frame.contentWindow.dispatchEvent(new Event('resize'));
        } catch (err) {
          // ignore cross-origin or other errors
        }
      }

      // whenever a map is shown, try trigger
      const observer = new MutationObserver(() => {
        const f = document.getElementById(mapToFrame[current]);
        if (f) triggerMapResize(f);
      });
      observer.observe(document.querySelector('.map-wrap'), { attributes: true, subtree: true, childList: true });
    });
  </script>

  <!-- bootstrap script (not required but included) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
